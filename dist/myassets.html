<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Assets - Intelligence Cubed</title>
    <link rel="icon" type="image/svg+xml" href="/assets/i3-token-logo-CdvslBCl.svg">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/i3-token-logo-6zPKW5Wv.png">  
    <link rel="apple-touch-icon" sizes="192x192" href="/assets/i3-token-logo-6zPKW5Wv.png"> 
    <link rel="preload" as="image" href="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='2500'%20height='2500'%20viewBox='0%200%2032%2032'%3e%3cg%20fill='none'%20fill-rule='evenodd'%3e%3ccircle%20cx='16'%20cy='16'%20r='16'%20fill='%23627EEA'/%3e%3cg%20fill='%23FFF'%20fill-rule='nonzero'%3e%3cpath%20fill-opacity='.602'%20d='M16.498%204v8.87l7.497%203.35z'/%3e%3cpath%20d='M16.498%204L9%2016.22l7.498-3.35z'/%3e%3cpath%20fill-opacity='.602'%20d='M16.498%2021.968v6.027L24%2017.616z'/%3e%3cpath%20d='M16.498%2027.995v-6.028L9%2017.616z'/%3e%3cpath%20fill-opacity='.2'%20d='M16.498%2020.573l7.497-4.353-7.497-3.348z'/%3e%3cpath%20fill-opacity='.602'%20d='M9%2016.22l7.498%204.353v-7.701z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns:xodm='http://www.corel.com/coreldraw/odm/2003'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20id='Layer_1'%20x='0px'%20y='0px'%20viewBox='0%200%202500%202500'%20style='enable-background:new%200%200%202500%202500;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%23F0B90B;}%20.st1{fill:none;}%20%3c/style%3e%3cg%20id='Layer_x0020_1'%3e%3cg%20id='_2082423948800'%3e%3cpath%20class='st0'%20d='M583.3,385.4L1250,0l666.7,385.4l-250,135.4L1250,281.2L822.9,520.8L583.3,385.4L583.3,385.4z%20M1906.2,864.6%20l-239.6-135.4L1250,968.8L822.9,729.2L583.3,864.6v281.3l416.7,239.6l0,489.6l239.6,145.8l239.6-145.8v-479.2l416.7-239.6V864.6%20L1906.2,864.6L1906.2,864.6z%20M1906.2,1635.4v-281.2L1666.7,1500v270.8L1906.2,1635.4L1906.2,1635.4z%20M2083.3,1729.2l-416.7,239.6%20V2250l666.7-385.4v-770.8l-250,156.2V1729.2z%20M1843.8,625l239.6,145.8v281.3l239.6-145.8V625l-239.6-145.8L1843.8,625L1843.8,625z%20M1000,2072.9v281.2l239.6,145.8l239.6-145.8v-281.2l-239.6,145.8L1000,2072.9L1000,2072.9z%20M583.3,1635.4l239.6,135.4v-281.2%20l-239.6-145.8V1635.4L583.3,1635.4z%20M1000,625l239.6,145.8l250-145.8L1250,479.2L1000,625z%20M406.2,770.8l250-145.8l-250-145.8%20L166.7,625v281.2l239.6,145.8V770.8z%20M406.2,1250l-239.6-145.8V1875l666.7,385.4v-281.2l-416.7-239.6l0-489.6H406.2L406.2,1250z'%3e%3c/path%3e%3crect%20y='0'%20class='st1'%20width='2500'%20height='2500'%3e%3c/rect%3e%3c/g%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns:xodm='http://www.corel.com/coreldraw/odm/2003'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20id='Layer_1'%20x='0px'%20y='0px'%20viewBox='0%200%202500%202500'%20style='enable-background:new%200%200%202500%202500;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:url(%23SVGID_1_);}%20.st1{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='Layer_x0020_1'%3e%3cg%20id='_1705781198752'%3e%3clinearGradient%20id='SVGID_1_'%20gradientUnits='userSpaceOnUse'%20x1='-457.2336'%20y1='2294.8784'%20x2='2120.7664'%20y2='713.8783'%20gradientTransform='matrix(1%200%200%20-1%200%202497.8899)'%3e%3cstop%20offset='0'%20style='stop-color:%23A229C5'%3e%3c/stop%3e%3cstop%20offset='1'%20style='stop-color:%237B3FE4'%3e%3c/stop%3e%3c/linearGradient%3e%3cpath%20class='st0'%20d='M1250,2500L1250,2500c688,0,1250-563,1250-1250l0,0C2500,562,1937,0,1250,0l0,0C562,0,0,563,0,1250l0,0%20C0,1938,563,2500,1250,2500z'%3e%3c/path%3e%3cpath%20class='st1'%20d='M1612,1520l354-204c19-11,30-31,30-53V855c0-22-12-42-30-53l-354-204c-19-11-42-11-61,0l-354,204%20c-19,11-30,31-30,53v730l-248,143l-248-143v-286l248-143l164,94v-192l-133-77c-9-5-20-8-30-8c-11,0-21,3-30,8l-354,204%20c-19,11-30,31-30,53v408c0,22,12,42,30,53l354,204c19,11,42,11,61,0l354-204c19-11,30-31,30-53V916l4-3l244-141l248,143v286%20l-248,143l-163-94v192l133,77c19,11,42,11,61,0l0,0L1612,1520z'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns:xodm='http://www.corel.com/coreldraw/odm/2003'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20id='Layer_1'%20x='0px'%20y='0px'%20viewBox='0%200%202500%202500'%20style='enable-background:new%200%200%202500%202500;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:none;}%20.st1{fill:%23213147;}%20.st2{fill:%2312AAFF;}%20.st3{fill:%239DCCED;}%20.st4{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='Layer_x0020_1'%3e%3cg%20id='_2405588477232'%3e%3crect%20class='st0'%20width='2500'%20height='2500'%3e%3c/rect%3e%3cg%3e%3cg%3e%3cpath%20class='st1'%20d='M226,760v980c0,63,33,120,88,152l849,490c54,31,121,31,175,0l849-490c54-31,88-89,88-152V760%20c0-63-33-120-88-152l-849-490c-54-31-121-31-175,0L314,608c-54,31-87,89-87,152H226z'%3e%3c/path%3e%3cg%3e%3cg%3e%3cg%3e%3cpath%20class='st2'%20d='M1435,1440l-121,332c-3,9-3,19,0,29l208,571l241-139l-289-793C1467,1422,1442,1422,1435,1440z'%3e%3c/path%3e%3c/g%3e%3cg%3e%3cpath%20class='st2'%20d='M1678,882c-7-18-32-18-39,0l-121,332c-3,9-3,19,0,29l341,935l241-139L1678,883V882z'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3cg%3e%3cpath%20class='st3'%20d='M1250,155c6,0,12,2,17,5l918,530c11,6,17,18,17,30v1060c0,12-7,24-17,30l-918,530c-5,3-11,5-17,5%20s-12-2-17-5l-918-530c-11-6-17-18-17-30V719c0-12,7-24,17-30l918-530c5-3,11-5,17-5l0,0V155z%20M1250,0c-33,0-65,8-95,25L237,555%20c-59,34-95,96-95,164v1060c0,68,36,130,95,164l918,530c29,17,62,25,95,25s65-8,95-25l918-530c59-34,95-96,95-164V719%20c0-68-36-130-95-164L1344,25c-29-17-62-25-95-25l0,0H1250z'%3e%3c/path%3e%3c/g%3e%3cpolygon%20class='st1'%20points='642,2179%20727,1947%20897,2088%20738,2234%20'%3e%3c/polygon%3e%3cg%3e%3cpath%20class='st4'%20d='M1172,644H939c-17,0-33,11-39,27L401,2039l241,139l550-1507c5-14-5-28-19-28L1172,644z'%3e%3c/path%3e%3cpath%20class='st4'%20d='M1580,644h-233c-17,0-33,11-39,27L738,2233l241,139l620-1701c5-14-5-28-19-28V644z'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2026.0.1,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20500%20500'%20style='enable-background:new%200%200%20500%20500;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%23FF0420;}%20.st1{fill:%23FFFFFF;}%20%3c/style%3e%3ccircle%20class='st0'%20cx='250'%20cy='250'%20r='250'/%3e%3cpath%20class='st1'%20d='M177.1,316.4c-14.9,0-27.1-3.5-36.6-10.5c-9.4-7.1-14.1-17.3-14.1-30.4c0-2.8,0.3-6.1,0.9-10.1%20c1.6-9,3.9-19.8,6.9-32.5c8.5-34.4,30.5-51.6,65.9-51.6c9.6,0,18.3,1.6,25.9,4.9c7.6,3.1,13.6,7.9,18,14.3%20c4.4,6.3,6.6,13.8,6.6,22.5c0,2.6-0.3,5.9-0.9,9.9c-1.9,11.1-4.1,22-6.8,32.5c-4.4,17.1-11.9,30-22.7,38.5%20C209.5,312.3,195.1,316.4,177.1,316.4z%20M179.8,289.4c7,0,12.9-2.1,17.8-6.2c5-4.1,8.6-10.4,10.7-19c2.9-11.8,5.1-22,6.6-30.8%20c0.5-2.6,0.8-5.3,0.8-8.1c0-11.4-5.9-17.1-17.8-17.1c-7,0-13,2.1-18,6.2c-4.9,4.1-8.4,10.4-10.5,19c-2.3,8.4-4.5,18.6-6.8,30.8%20c-0.5,2.5-0.8,5.1-0.8,7.9C161.7,283.7,167.8,289.4,179.8,289.4z'/%3e%3cpath%20class='st1'%20d='M259.3,314.6c-1.4,0-2.4-0.4-3.2-1.3c-0.6-1-0.8-2.1-0.6-3.4l25.9-122c0.2-1.4,0.9-2.5,2.1-3.4%20c1.1-0.9,2.3-1.3,3.6-1.3H337c13.9,0,25,2.9,33.4,8.6c8.5,5.8,12.8,14.1,12.8,25c0,3.1-0.4,6.4-1.1,9.8c-3.1,14.4-9.4,25-19,31.9%20c-9.4,6.9-22.3,10.3-38.7,10.3h-25.3l-8.6,41.1c-0.3,1.4-0.9,2.5-2.1,3.4c-1.1,0.9-2.3,1.3-3.6,1.3H259.3z%20M325.7,242.9%20c5.3,0,9.8-1.4,13.7-4.3c4-2.9,6.6-7,7.9-12.4c0.4-2.1,0.6-4,0.6-5.6c0-3.6-1.1-6.4-3.2-8.3c-2.1-2-5.8-3-10.9-3h-22.5l-7.1,33.6%20H325.7z'/%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3csvg%20height='1927'%20viewBox='-2.2%200%20402.1%20311.7'%20width='2500'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3clinearGradient%20id='a'%3e%3cstop%20offset='0'%20stop-color='%2300ffa3'/%3e%3cstop%20offset='1'%20stop-color='%23dc1fff'/%3e%3c/linearGradient%3e%3clinearGradient%20id='b'%20gradientTransform='matrix(1%200%200%20-1%200%20314)'%20gradientUnits='userSpaceOnUse'%20x1='360.879'%20x2='141.213'%20xlink:href='%23a'%20y1='351.455'%20y2='-69.294'/%3e%3clinearGradient%20id='c'%20gradientTransform='matrix(1%200%200%20-1%200%20314)'%20gradientUnits='userSpaceOnUse'%20x1='264.829'%20x2='45.163'%20xlink:href='%23a'%20y1='401.601'%20y2='-19.148'/%3e%3clinearGradient%20id='d'%20gradientTransform='matrix(1%200%200%20-1%200%20314)'%20gradientUnits='userSpaceOnUse'%20x1='312.548'%20x2='92.882'%20xlink:href='%23a'%20y1='376.688'%20y2='-44.061'/%3e%3cpath%20d='m64.6%20237.9c2.4-2.4%205.7-3.8%209.2-3.8h317.4c5.8%200%208.7%207%204.6%2011.1l-62.7%2062.7c-2.4%202.4-5.7%203.8-9.2%203.8h-317.4c-5.8%200-8.7-7-4.6-11.1z'%20fill='url(%23b)'/%3e%3cpath%20d='m64.6%203.8c2.5-2.4%205.8-3.8%209.2-3.8h317.4c5.8%200%208.7%207%204.6%2011.1l-62.7%2062.7c-2.4%202.4-5.7%203.8-9.2%203.8h-317.4c-5.8%200-8.7-7-4.6-11.1z'%20fill='url(%23c)'/%3e%3cpath%20d='m333.1%20120.1c-2.4-2.4-5.7-3.8-9.2-3.8h-317.4c-5.8%200-8.7%207-4.6%2011.1l62.7%2062.7c2.4%202.4%205.7%203.8%209.2%203.8h317.4c5.8%200%208.7-7%204.6-11.1z'%20fill='url(%23d)'/%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns:xodm='http://www.corel.com/coreldraw/odm/2003'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20id='Layer_1'%20x='0px'%20y='0px'%20viewBox='0%200%202500%202500'%20style='enable-background:new%200%200%202500%202500;'%20xml:space='preserve'%3e%3cg%20id='Layer_x0020_1'%3e%3cpath%20d='M1247.8,2500c691.6,0,1252.2-559.6,1252.2-1250C2500,559.6,1939.4,0,1247.8,0C591.7,0,53.5,503.8,0,1144.9h1655.1v210.2H0%20C53.5,1996.2,591.7,2500,1247.8,2500z'%3e%3c/path%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2027.2.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20400%20400'%20style='enable-background:new%200%200%20400%20400;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill-rule:evenodd;clip-rule:evenodd;fill:%23FFFFFF;}%20.st1{fill-rule:evenodd;clip-rule:evenodd;}%20%3c/style%3e%3crect%20class='st0'%20width='400'%20height='400'/%3e%3cg%3e%3cpath%20class='st1'%20d='M316,199l-66.7-66.4v48.6l-66.2,48.7l66.2,0v35.5L316,199z'/%3e%3cpath%20class='st1'%20d='M81,199l66.7,66.4v-48.3l66.2-49.1l-66.2,0v-35.5L81,199z'/%3e%3c/g%3e%3c/svg%3e">
    <link rel="preload" as="image" href="data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20fill='%23000000'%20xmlns='http://www.w3.org/2000/svg'%20id='Bnb-Line--Streamline-Remix'%20height='16'%20width='16'%3e%3cdesc%3e%20Bnb%20Line%20Streamline%20Icon:%20https://streamlinehq.com%20%3c/desc%3e%3cpath%20d='m7.999933333333333%2013.792666666666666%20-1.3394066666666666%20-0.7754666666666666%20-0.0018466666666666666%201.5396L8%2015.333333333333332l1.3409999999999997%20-0.7763333333333333%20-0.0018666666666666666%20-1.5396%20-1.3392%200.7752666666666667Zm2.6715999999999998%20-1.5466666666666664%200.0018666666666666666%201.5396L14.333333333333332%2011.666666666666666v-4.2362l-1.3333333333333333%200.7676666666666666v2.6997999999999998l-2.3284666666666665%201.3480666666666665ZM13%206.659599999999999l1.3333333333333333%20-0.7676733333333333V4.333333333333333l-1.3306%20-0.7703466666666667%20-1.3306%200.7703333333333333L13%205.102073333333333V6.659599999999999Zm-2.6584%20-3.096613333333333%201.3305333333333333%20-0.7703333333333333L8%200.6666666666666666%204.327773333333333%202.7926933333333332l1.3305733333333332%200.7703333333333333%202.3415866666666663%20-1.3556666666666666%202.341666666666667%201.3556266666666668ZM4.327773333333333%204.33336l-1.3305799999999999%20-0.7703333333333333L1.6666666666666665%204.333333333333333v1.5588666666666664l1.3332933333333332%200.7676466666666666V5.1020933333333325l1.3278133333333333%20-0.7687333333333333ZM1.6666666666666665%207.430733333333333l1.3332933333333332%200.7676666666666666v2.699533333333333l2.3281533333333333%201.3478666666666665%20-0.0018399999999999998%201.5396L1.6666666666666665%2011.666666666666666v-4.2359333333333336Zm9.999933333333333%20-1.5599%20-1.3250666666666666%20-0.7671600000000001%20-2.3415999999999997%201.3556733333333333%20-2.3415466666666664%20-1.3556266666666668L4.333333333333333%205.870853333333333v1.55668l2.332273333333333%201.3428%20-0.00324%202.7072666666666665%201.3375666666666666%200.7744%201.337333333333333%20-0.7742%20-0.0031999999999999997%20-2.707533333333333%202.332533333333333%20-1.343V5.870833333333334ZM5.32996%2010.706266666666666l0.0013933333333333332%20-1.1656L4.333333333333333%208.966066666666666v1.1631999999999998l0.9966266666666665%200.577Zm1.6589733333333332%20-6.372879999999999%201.011%200.5852933333333333%201.011%20-0.58534L8%203.7480466666666663l-1.0110666666666666%200.58534Zm3.6794%205.207213333333333%200.9982666666666666%20-0.5747333333333333v1.1633333333333333l-0.9968666666666667%200.5771999999999999%20-0.0013999999999999998%20-1.1658Z'%20stroke-width='0.6667'%3e%3c/path%3e%3c/svg%3e"> 

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>
    
    <!-- Binance Web3 Wallet SDK Provider (for QR code connection) -->
    <!-- Using npm bundle with proper crypto polyfills -->
    
    <!-- Base Account SDK -->
    <script src="https://unpkg.com/@base-org/account/dist/base-account.min.js"></script>
    
    <script>
        // 简单的初始化
        window.cdpConnect = async function() {
            if (!window.createBaseAccountSDK) {
                throw new Error('Base Account SDK not loaded');
            }
            
            const provider = window.createBaseAccountSDK({
                appName: 'Intelligence Cubed',
                appLogoUrl: 'https://intelligencecubed.netlify.app/png/i3-token-logo.png'
            }).getProvider();
            
            // 直接请求账户连接，跳过复杂的身份验证流程
            const accounts = await provider.request({
                method: 'eth_requestAccounts'
            });
            
            if (accounts && accounts.length > 0) {
                return { address: accounts[0] };
            }
            
            throw new Error('No accounts returned');
        };

    </script>

    <!-- 仅在旧浏览器需要；现代浏览器也可以保留，不会有副作用 -->
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"></script>

    <script type="module-shim">
	  // ========= AppKit loader with CDN fallback (fixed 1.8.4) =========
	  const PROJECT_ID = '87a5da024dea0385e2d43dcad60b4935';
	  async function load(kind) {
	    if (kind === 'unpkg') {
	      const { createAppKit } = await import('https://unpkg.com/@reown/appkit@1.8.4/dist/index.js?module');
	      const nets = await import('https://unpkg.com/@reown/appkit@1.8.4/networks/index.js?module');
	      return { createAppKit, nets };
	    }
	    if (kind === 'jsdelivr') {
	      const { createAppKit } = await import('https://cdn.jsdelivr.net/npm/@reown/appkit@1.8.4/+esm');
	      const nets = await import('https://cdn.jsdelivr.net/npm/@reown/appkit@1.8.4/networks/+esm');
	      return { createAppKit, nets };
	    }
	    // esm.sh 作为第三备选
	    const { createAppKit } = await import('https://esm.sh/@reown/appkit@1.8.4');
	    const nets = await import('https://esm.sh/@reown/appkit@1.8.4/networks');
	    return { createAppKit, nets };
	  }
	  let mod;
	  try { mod = await load('unpkg'); }
	  catch { try { mod = await load('jsdelivr'); } catch { mod = await load('esmsh'); } }
	  const { createAppKit, nets } = mod;
	  // ① 读取"首选网络"（你模块里 setPreferredNetwork 写入的）
	  const pref = (window.getPreferredNetwork && window.getPreferredNetwork()) || { key: 'ethereum', kind: 'evm' };
	  // ② I3 → AppKit 网络映射（按你当前 1.8.4 可用的 nets 字段来对齐）
	  const map = {
	    ethereum:  nets.mainnet,
	    sepolia:   nets.sepolia,     // 测试链可选
	    polygon:   nets.polygon,
	    bnb:       nets.bsc,
	    arbitrum:  nets.arbitrum,
	    optimism:  nets.optimism,
	    avalanche: nets.avalanche,
	    fantom:    nets.fantom,
	    gnosis:    nets.gnosis,
	    linea:     nets.linea,
	    scroll:    nets.scroll,
	    zksync:    nets.zksync
	    // 如需 base / polygonZkEvm，请确认 1.8.4 是否暴露相应键后再补：
	    // base: nets.base,
	    // 'polygon-zkevm': nets.polygonZkEvm,
	  };
	  // ③ 允许在 AppKit 弹窗里展示的链（你现在 index 原本列的我都保留了）
	  const allowKeys = [
	    'ethereum','sepolia','polygon','bnb','arbitrum','optimism',
	    'avalanche','fantom','gnosis','linea','scroll','zksync'
	  ];
	  // 如果用户在模块里选了 Solana（kind === 'solana'），AppKit 依然只管 EVM，
	  // 这里就把默认链回退到 ethereum，避免无效首选
	  const effectivePrefKey = (pref.kind === 'evm' && map[pref.key]) ? pref.key : 'ethereum';
	  // ④ 计算默认链 & 列表（把默认链置顶，其他按 allowKeys 顺序去重追加）
	  const defaultNet = map[effectivePrefKey] || nets.mainnet;
	  const allowedList = allowKeys.map(k => map[k]).filter(Boolean);
	  const networks = [defaultNet, ...allowedList.filter(n => n !== defaultNet)];
	  // ⑤ 创建 AppKit —— 1.8.4 有的版本支持 defaultNetwork，没有也不报错
	  const modal = createAppKit({
	    projectId: PROJECT_ID,
	    networks,
	    // 某些版本支持；若控制台提示不识别可以忽略这行
	    defaultNetwork: defaultNet,
	    metadata: {
	      name: 'Intelligence Cubed',
	      description: 'AI Terminal for Web3',
	      url: 'https://intelligencecubed.netlify.app',
	      icons: ['https://intelligencecubed.netlify.app/png/i3-token-logo.png']
	    }
	  });
	  // 暴露给业务代码
	  window.appkit = modal;
	  // 兼容你现有 initializeWalletConnect 的等待逻辑
	  window.dispatchEvent(new Event('reownAppKitLoaded'));
	  console.log('[OK] AppKit loaded', { defaultNet, networks, modal });
	</script>

    <script type="module-shim">
	  import {
	    Connection,
	    clusterApiUrl,
	    PublicKey
	  } from 'https://esm.sh/@solana/web3.js@1.95.3';
	  window.SOL = { Connection, clusterApiUrl, PublicKey };
	</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
		.wallet-modal {
		  display: flex !important;            /* 始终 flex 布局 */
		  align-items: center !important;      /* 始终垂直居中 */
		  justify-content: center !important;  /* 始终水平居中 */
		  position: fixed !important;
		  inset: 0 !important;
		  z-index: 10000;
		  background: rgba(0,0,0,.4);          /* ✅ 正确写法 */
		  opacity: 0;
		  transition: opacity .25s ease;
		  pointer-events: none;                /* 关闭时不可点击 */
		}
		.wallet-modal.show {
		  opacity: 1;
		  pointer-events: auto;                /* 打开时可点击 */
		}
		.wallet-modal-content {
		  position: relative;
		  background: #fff;
		  border-radius: 24px;
		  padding: 36px;
		  max-width: 440px;
		  width: 92%;
		  max-height: 80vh;
		  overflow-y: auto;
		  box-shadow: 0 12px 40px rgba(0,0,0,.12); /* ✅ 正确写法 */
		  transform: scale(.95);
		  opacity: 0;
		  transition: transform .25s ease, opacity .25s ease;
		}
		.wallet-modal.show .wallet-modal-content {
		  transform: scale(1);
		  opacity: 1;
		}

        /* 移除可能导致问题的动画 */
        @keyframes modalSlideIn {
            to { transform: none !important; }
        }

        .wallet-modal-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .wallet-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            font-family: 'Inter', sans-serif;
        }

        .wallet-modal-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 400;
            line-height: 1.5;
        }

        .wallet-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f3f4f6;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #6b7280;
        }

        .wallet-close-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }

        /* 钱包选项卡片 */
        /* 更紧凑的卡片与行距 */
		.wallet-option {
		  display: flex;
		  align-items: center;
          justify-content: center;
		  gap: 12px;
		  padding: 12px 14px;          /* 原 20px -> 更紧凑 */
		  border: 1px solid #e5e7eb;
		  border-radius: 8px;          /* 原 16px/24px -> 8px */
		  background: #fff;
		  transition: background .2s ease, border-color .2s ease, transform .2s ease;
		}
		.wallet-option:hover {
		  border-color: #d1d5db;
		  background: #f9fafb;         /* 去掉大面积渐变 */
		  transform: translateY(-1px);
		}
		/* 列表项间距更紧凑 */
		.wallet-options { 
		  display: flex; 
		  flex-direction: column; 
		  gap: 12px;                   /* 原 16px -> 12px */
		}

		/* 钱包文字信息 */
		/* 标题文字：沉稳、左对齐，不漂浮 */
		.wallet-name {
		  font-size: 14px;
		  font-weight: 500;
		  color: #111827;
		  line-height: 1;

		}
		/* 副标题（如果使用）弱化显示，同样左齐 */
		.wallet-description {
		  font-size: 12px;
		  color: #6b7280;
		  line-height: 1.2;
		}
		/* 状态与箭头 */
		.wallet-status.status-available { background: rgba(16,185,129,.1); color:#059669; }
        .wallet-icon-wrap{
		  width:24px;
		  height:24px;
		  display:flex;
		  align-items:center;
		  justify-content:center;
		  flex-shrink:0;            /* 防止挤压 */
		}
		/* 放 <img> 的情况 */
		.wallet-icon-wrap img{
		  width:100%;
		  height:100%;
		  object-fit:contain;       /* 等比不变形 */
		  display:block;
		}
		/* 放 <svg> 直插的情况 */
		.wallet-icon-wrap svg{
		  width:24px;
		  height:24px;
		  display:block;
		}

        /* Account 按钮右侧的小图标 */
		#walletTypeIcon {
		  width: 18px;
		  height: 18px;
		  margin-left: 8px;
		  vertical-align: middle;
		  display: none;        /* 默认隐藏，连接后再显示 */
		  object-fit: contain;  /* 防止变形 */
		}

        .wallet-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #6b7280;    /* 灰色，低调一点 */
            font-weight: 400;
        }


        /* 响应式设计 */
        @media (max-width: 480px) {
            .wallet-modal-content {
                padding: 24px;
                margin: 20px;
                width: calc(100% - 40px);
            }

            .wallet-modal-title {
                font-size: 1.25rem;
            }

            .wallet-name {
                font-size: 1rem;
            }
        }

/* Network modal (独立于 wallet modal) */
		.network-modal {
		  position: fixed;
		  inset: 0;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  background: rgba(17, 24, 39, 0.6);
		  backdrop-filter: blur(2px);
		  opacity: 0;
		  pointer-events: none;
		  transition: opacity .25s ease;
		  z-index: 10010;
		}
		.network-modal.show {
		  opacity: 1;
		  pointer-events: auto;
		}
		.network-modal-content {
		  width: min(420px, 92vw);
		  background: #fff;
		  border-radius: 12px;                  /* 圆角更小，更紧凑 */
		  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
		  padding: 24px 24px 20px;
		  transform: scale(.95);
		  opacity: 0;
		  transition: transform .25s ease, opacity .25s ease;
		}
		.network-modal.show .network-modal-content {
		  transform: scale(1);
		  opacity: 1;
		}
		.network-modal-header {
		  display: flex;
		  align-items: center;
		  justify-content: space-between;
		  margin-bottom: 24px;
		}
		.network-modal-title {
		  font-size: 18px;
		  font-weight: 600;
		  color: #1f2937;
		}
		.network-modal-subtitle {
		  font-size: 13px;
		  color: #6b7280;
		  margin-top: 4px;
		}
		.network-close-btn {
		  border: none;
		  background: transparent;
		  font-size: 18px;
		  line-height: 1;
		  cursor: pointer;
		  color: #6b7280;
		  transition: color .2s ease;
		}
		.network-close-btn:hover {
		  color: #111827;
		}
		.network-modal-footer {
		  text-align: center;
		  margin-top: 16px;
		  font-size: 13px;
		  color: #6b7280;
		}
		/* 弹窗里的按钮样式：更紧凑，规整 */
		.network-modal-content .wallet-option {
		  display: flex;
		  align-items: center;       /* 图标 + 文字垂直居中 */
		  justify-content: flex-start;
		  gap: 12px;
		  padding: 12px 14px;        /* 紧凑内边距 */
		  border: 1px solid #e5e7eb;
		  border-radius: 8px;        /* 小圆角 */
		  background: #fff;
		  transition: background .2s ease, border-color .2s ease, transform .2s ease;
		}
		.network-modal-content .wallet-option:hover {
		  border-color: #d1d5db;
		  background: #f9fafb;       /* 简单浅灰 hover */
		  transform: translateY(-1px);
		}
		.network-modal-content .wallet-name {
		  font-size: 14px;
		  font-weight: 500;
		  color: #111827;
		}
		.network-modal-content .wallet-description {
		  font-size: 12px;
		  color: #6b7280;
		}

        /* --- Current Network badge --- */
		.network-badge{
		  display:inline-flex; align-items:center; gap:8px;
		  background:#f3f4f6; color:#1f2937;
		  border:1px solid #e5e7eb; border-radius:999px;
		  padding:6px 12px; margin-right:12px;
		  height:34px; line-height:1; white-space:nowrap;
		}
		.network-badge__icon{ width:20px; height:20px; object-fit:contain; display:block }
		.network-badge__text{ font-size:14px; font-weight:600; letter-spacing:.2px }
		.network-badge__caret{ width:16px; height:16px; opacity:.6 }
		/* @media (max-width: 768px){
		  .network-badge{ display:none !important; }
		} */

        /* Token logo styling */
        .token-logo {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-left: 4px;
        }
    
        .token-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-left: 4px;
        }
        
        /* Follow X Modal */
        .follow-x-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .follow-x-modal.show {
            display: flex;
            opacity: 1;
        }

        .follow-x-modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 480px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            transform: scale(0.95);
            transition: transform 0.25s ease;
        }

        .follow-x-modal.show .follow-x-modal-content {
            transform: scale(1);
        }

        .follow-x-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #f3f4f6;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 18px;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .follow-x-close:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .follow-x-modal-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .follow-x-modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .follow-x-modal-subtitle {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.6;
        }

        .follow-x-input-group {
            margin-bottom: 20px;
        }

        .follow-x-input-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .follow-x-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .follow-x-input {
            flex: 1;
            padding: 12px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            color: #111827;
            transition: all 0.2s ease;
        }

        /* 输入框聚焦的高光也从绿色改为品牌紫 */
        .follow-x-input:focus {
          outline: none;
          border-color: #8b5cf6;
          box-shadow: 0 0 0 3px rgba(139,92,246,.15);
        }

        .follow-x-input:readonly {
            background: #f9fafb;
            color: #6b7280;
        }

        /* Follow 弹窗 - 打开 X 的按钮也用品牌紫 */
        .follow-x-button {
          padding: 12px 20px;
          background: linear-gradient(135deg,#8b5cf6,#7c3aed);
          color: #fff;
          border: none;
          border-radius: 10px;
          font-size: 14px;
          font-weight: 700;
          cursor: pointer;
          transition: all .2s ease;
          white-space: nowrap;
        }

        .follow-x-button:hover {
          transform: translateY(-1px);
          box-shadow: 0 6px 16px rgba(124,58,237,.32);
        }

        /* 弹窗底部 Confirm 按钮统一为品牌紫 */
        .confirm-button {
          width: 100%;
          padding: 14px;
          background: linear-gradient(135deg,#8b5cf6,#7c3aed);
          color: #fff;
          border: none;
          border-radius: 10px;
          font-size: 15px;
          font-weight: 700;
          cursor: pointer;
          transition: all .2s ease;
          margin-top: 8px;
        }
        .confirm-button:hover {
          transform: translateY(-1px);
          box-shadow: 0 6px 16px rgba(124,58,237,.32);
        }

        .confirm-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            text-align: center;
        }

        .status-message.pending {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        @media (max-width: 480px) {
            .follow-x-modal-content {
                padding: 24px;
                width: 95%;
            }
            
            .follow-x-input-wrapper {
                flex-direction: column;
                gap: 8px;
            }
            
            .follow-x-button {
                width: 100%;
            }
        }
    </style>
  <script type="module" crossorigin src="/assets/solana-checkin-_e3KeuO4.js"></script>
  <script type="module" crossorigin src="/binance-sdk.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/solana-checkin-BTSOEDOI.css">
  <link rel="stylesheet" crossorigin href="/assets/myassets-BKQ27pf9.css">
  <link rel="stylesheet" crossorigin href="/assets/main-DE1Xteso.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <!-- Left Section -->
            <div class="header-left">
                <!-- 移动端菜单按钮 -->
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
                    <img src="/assets/I3%20logo-BqdHIQfx.svg" alt="Intelligence Cubed" class="logo-image">
                </div>
                <nav class="nav-menu">
                    <button class="nav-item" onclick="window.location.href='index.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Chats
                    </button>
                    <button class="nav-item" onclick="window.location.href='modelverse.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="m2 17 10 5 10-5" stroke="currentColor" stroke-width="2"/>
                            <path d="m2 12 10 5 10-5" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Modelverse
                    </button>
                    <button class="nav-item" onclick="window.location.href='benchmark.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Benchmark
                    </button>
                    <button class="nav-item" onclick="window.location.href='canvas.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M9 9h6v6H9z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Canvas
                    </button>
                    <button class="nav-item" onclick="window.location.href='workflow.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Workflows
                    </button>
                    <button class="nav-item" onclick="window.location.href='mycart.html'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M7 4V2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M5 4h14l-1 14H6L5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        MyCart
                    </button>
                </nav>

                <!-- 移动端导航菜单 -->
                <div class="mobile-nav-overlay" onclick="closeMobileMenu()"></div>
                <div class="mobile-nav-menu">
                    <button class="nav-item" onclick="window.location.href='index.html'">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Chats
                    </button>
                    <button class="nav-item" onclick="window.location.href='modelverse.html'">Modelverse</button>
                    <button class="nav-item" onclick="window.location.href='benchmark.html'">Benchmark</button>
                    <button class="nav-item" onclick="window.location.href='canvas.html'">Canvas</button>
                    <button class="nav-item" onclick="window.location.href='workflow.html'">Workflows</button>
                    <button class="nav-item" onclick="window.location.href='mycart.html'">MyCart</button>
                </div>
            </div>

            <!-- Right Section -->
			<div class="header-right">
                <button id="networkBadge" class="network-badge" type="button" style="display:none" onclick="openNetworkPickerModal()">
				  <img class="network-badge__icon" src="" alt="">
				  <span class="network-badge__text">Network</span>
			        <svg class="network-badge__caret" width="12" height="12" viewBox="0 0 24 24">
				        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/>
				    </svg>
				</button>
			  <div class="user-section">
			    <div id="accountDropdownMount"></div>
			  </div>
			</div>
        </div>
    </header>

                <!-- Right Section -->
            <div class="header-right">
                <!-- Current Network badge (shows only after wallet connected) -->
                <button id="networkBadge" class="network-badge" type="button" style="display:none" onclick="openNetworkPickerModal()">
				  <img class="network-badge__icon" src="" alt="">
				  <span class="network-badge__text">Network</span>
			        <svg class="network-badge__caret" width="12" height="12" viewBox="0 0 24 24">
				        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/>
				    </svg>
				</button>
                <div id="networkPickerMount"></div>
                <div class="user-section">
                    <div id="accountDropdownMount"></div>
                </div>
            </div>
        </div>
    </header>


    <script>
	(function syncRenderNetworkBadge(){
	  try {
	    // 1) 读取本地"首选网络"（你已有 getPreferredNetwork）
	    var pref = (window.getPreferredNetwork && window.getPreferredNetwork()) || null;
	    // 2) 快速映射（仅用于首屏，不依赖任何 SDK）
	    var ICON = {
	      ethereum: '/svg/chains/ethereum.svg',
	      bnb:      '/svg/chains/bnb.svg',
	      polygon:  '/svg/chains/polygon-zkevm.svg',
	      arbitrum: '/svg/chains/arbitrum.svg',
	      optimism: '/svg/chains/optimism.svg',
	      solana:   '/svg/chains/solana.svg',
          opbnb:   '/svg/chains/opbnb.svg',
          zksync:   '/svg/chains/zksync.svg',
          base:   '/svg/chains/base.svg',   
	    };
	    var NAME = {
	      ethereum: 'Ethereum',
	      bnb:      'BNB Chain',
	      polygon:  'Polygon',
	      arbitrum: 'Arbitrum',
	      optimism: 'Optimism',
	      solana:   'Solana',
          opbnb:   'opBNB',
          zksync:   'Zksync',
          base:   'Base',
	    };
	    // 3) 找到徽章节点（你按钮里已有这些 id）
	    var badge  = document.getElementById('networkBadge');
	    var iconEl = document.getElementById('networkBadgeIcon');
	    var textEl = document.getElementById('networkBadgeText');
	    if (!badge || !iconEl || !textEl) return;
	    // 4) 计算首屏 key：Solana 直接显示 solana，其它默认 ethereum
	    var key  = (pref && pref.key)  || 'ethereum';
	    var kind = (pref && pref.kind) || 'evm';
	    if (kind === 'solana') key = 'solana';
	    // 5) 同步渲染，不等 SDK
	    iconEl.src = ICON[key] || ICON.ethereum;
	    iconEl.alt = NAME[key] || 'Network';
	    textEl.textContent = NAME[key] || 'Network';
	    badge.style.display = 'inline-flex';
	    badge.style.visibility = 'visible'; // 解除初始隐藏
	  } catch (e) {
	    // 静默失败，避免阻塞首屏
	  }
	})();
	</script>

    <!-- Main Content -->
    <main class="main-content">
        <div class="assets-container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-content">
                    <div class="title-section">
                        <h1 class="page-title">My Assets</h1>
                        <p class="page-subtitle">Manage your model tokens and shares portfolio</p>
                    </div>
                </div>
            </div>

            <!-- Assets Overview -->
            <div class="assets-overview">
                <div class="overview-card">
                    <div class="card-icon tokens-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <h3>Total Tokens</h3>
                        <p class="card-value" id="totalTokenValue">0.00 <img src="/assets/i3-token-logo-CdvslBCl.svg" class="token-logo" alt="i3"></p>
                        <p class="card-change positive" id="totalTokenChange">+0.00%</p>
                    </div>
                </div>

                <div class="overview-card">
                    <div class="card-icon shares-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <h3>Total Share Value</h3>
                        <p class="card-value" id="totalShareValue">0.00 <img src="/assets/i3-token-logo-CdvslBCl.svg" class="token-logo" alt="i3"></p>
                        <p class="card-change negative" id="totalShareChange">+0.00%</p>
                    </div>
                </div>

                <!-- 新增 I3 Tokens 余额卡片 -->
                <div class="overview-card">
                    <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <h3>I3 Token Balance</h3>
                        <p class="card-value" id="i3TokenBalance">0 <img src="/assets/i3-token-logo-CdvslBCl.svg" class="token-logo" alt="i3"></p>
                        <p class="card-change" id="i3TokenChange" style="display: none;">Available for spending</p>
                    </div>
                </div>

            </div>

            <!-- Tabs -->
            <div class="assets-tabs">
                <button class="tab-btn active" onclick="showTab('tokens')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6"/>
                    </svg>
                    My Model Tokens
                </button>
                <button class="tab-btn" onclick="showTab('shares')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                    </svg>
                    My Model Shares
                </button>
                <button class="tab-btn" onclick="showTab('workflows')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    </svg>
                    My Workflows
                </button>
            </div>

            <!-- My Model Tokens Tab -->
            <div class="tab-content active" id="tokensTab">
                <div class="section-header">
                    <h2>My Model Tokens</h2>
                    <p class="section-subtitle">Track your token usage and remaining capacity</p>
                </div>

                <div class="empty-state" id="emptyTokens" style="display: none;">
                    <div class="empty-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6"/>
                        </svg>
                    </div>
                    <h3>No Model Tokens Yet</h3>
                    <p>Purchase some model tokens from the <a href="modelverse.html">Modelverse</a> to get started!</p>
                </div>

                <div class="assets-table-container" id="tokensTable">
                    <table class="assets-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Category</th>
                                <th>Tokens Owned</th>
                                <th>Estimated Uses</th>
                                <th>Token Price</th>
                                <th>Total Value</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tokensTableBody">
                            <!-- Token rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- My Model Shares Tab -->
            <div class="tab-content" id="sharesTab">
                <div class="section-header">
                    <h2>My Model Shares</h2>
                    <p class="section-subtitle">Monitor your share investments and market performance</p>
                </div>

                <div class="empty-state" id="emptyShares" style="display: none;">
                    <div class="empty-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                        </svg>
                    </div>
                    <h3>No Model Shares Yet</h3>
                    <p>Invest in some model shares from the <a href="modelverse.html">Modelverse</a> to start earning!</p>
                </div>

                <div class="assets-table-container" id="sharesTable">
                    <table class="assets-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Category</th>
                                <th>Shares Owned</th>
                                <th>Current Price</th>
                                <th>Market Change</th>
                                <th>Pool Ownership</th>
                                <th>Total Value</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sharesTableBody">
                            <!-- Share rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- My Workflows Tab -->
            <div class="tab-content" id="workflowsTab">
                <div class="section-header">
                    <h2>My Workflows</h2>
                    <p class="section-subtitle">Manage your private workflow designs and automations</p>
                </div>

                <div class="empty-state" id="emptyWorkflows" style="display: none;">
                    <div class="empty-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                    </div>
                    <h3>No Private Workflows Yet</h3>
                    <p>Create and save your custom workflows from the <a href="canvas.html">Canvas</a> to access them here!</p>
                </div>

                <div class="assets-table-container" id="workflowsTable">
                    <table class="assets-table">
                        <thead>
                            <tr>
                                <th>Workflow Name</th>
                                <th>Models Used</th>
                                <th>Created Date</th>
                                <th>Last Modified</th>
                                <th>Status</th>
                                <th>Privacy</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="workflowsTableBody">
                            <!-- Workflow rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>       
    </main>

    <script src="contract-config.js"></script>
    <script src="config.js"></script>
    <script src="api-manager.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="model-data.js"></script>
    <script src="myassets.js"></script>
    <script src="wallet-manager.js"></script>
	<script src="wallet-integration.js"></script>
	<script src="account-dropdown.js"></script>  
 
    <script src="onchain-checkin.js"></script>
    <!-- Follow X Modal -->
    <div id="followXModal" class="follow-x-modal">
        <div class="follow-x-modal-content">
            <button class="follow-x-close" onclick="closeFollowXModal()">✕</button>
            
            <div class="follow-x-modal-header">
                <h2 class="follow-x-modal-title">Follow the Team</h2>
                <p class="follow-x-modal-subtitle">
                    Follow @I3_Cubed on X (Twitter) and enter your Twitter handle to complete the task.
                </p>
            </div>

            <div class="follow-x-input-group">
                <label>1. Follow our X account</label>
                <div class="follow-x-input-wrapper">
                    <input type="text" class="follow-x-input" value="I3_Cubed" readonly>
                    <button class="follow-x-button" onclick="openTwitterProfile()">
                        Follow
                    </button>
                </div>
            </div>

            <div class="follow-x-input-group">
                <label>2. Enter your Twitter handle</label>
                <div class="follow-x-input-wrapper">
                    <input type="text" 
                           id="twitterHandleInput" 
                           class="follow-x-input" 
                           placeholder="@YourTwitterHandle">
                </div>
            </div>

            <button class="confirm-button" onclick="confirmFollowX()">
                Confirm
            </button>

            <div id="followXStatus" class="status-message" style="display: none;"></div>
        </div>
    </div>
    <script src="social-tasks.js"></script>
    <script>
    function toggleMobileMenu() {
        const menu = document.querySelector('.mobile-nav-menu');
        const overlay = document.querySelector('.mobile-nav-overlay');
        menu.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    function closeMobileMenu() {
        const menu = document.querySelector('.mobile-nav-menu');
        const overlay = document.querySelector('.mobile-nav-overlay');
        menu.classList.remove('active');
        overlay.classList.remove('active');
    }
    </script>

</body>
</html>     <script>
      document.addEventListener('DOMContentLoaded', function(){
        try { injectAccountDropdown('#accountDropdownMount'); } catch (e) { console.warn('injectAccountDropdown failed:', e); }
      });
    </script>

    <!-- Google 认证功能 - 直接内联实现 -->
    <script>
        // Firebase 配置 - 请替换为您的实际配置
        const firebaseConfig = {
            apiKey: "AIzaSyCYdWqXjUfNbUAMWlcm8neZQGTBTA63pfM",
            authDomain: "i3-testnet.firebaseapp.com",
            projectId: "i3-testnet",
            storageBucket: "i3-testnet.firebasestorage.app",
            messagingSenderId: "892139814159",
            appId: "1:892139814159:web:4df8548eef1d9bd9a1927a",
            measurementId: "G-KCDG3D1FCC"
        };


        // 配置验证函数
        function validateFirebaseConfig() {
            const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
            const missingFields = requiredFields.filter(field => !firebaseConfig[field] || firebaseConfig[field] === '');
            
            if (missingFields.length > 0) {
                console.error('❌ Firebase 配置缺少字段:', missingFields);
                return false;
            }
            
            // 检查 API Key 格式
            if (!firebaseConfig.apiKey.startsWith('AIzaSy') || firebaseConfig.apiKey.length < 30) {
                console.error('❌ Firebase API Key 格式不正确');
                return false;
            }
            
            console.log('✅ Firebase 配置验证通过');
            return true;
        }

        // 全局变量
        let firebaseApp = null;
        let firebaseAuth = null;
        let firebaseDb = null;
        let currentUser = null;

        // 初始化 Firebase - 修复时序问题
        async function initializeFirebase() {
            try {
                // 首先验证配置
                if (!validateFirebaseConfig()) {
                    throw new Error('Firebase 配置验证失败，请检查配置信息');
                }
                
                console.log('🚀 开始初始化 Firebase...');
                
                // 动态加载 Firebase SDK
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js');
                const { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
                const { getFirestore, initializeFirestore, doc, setDoc, getDoc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                
                // 初始化应用
                firebaseApp = initializeApp(firebaseConfig);
                firebaseAuth = getAuth(firebaseApp);
                // Connect to the named Firestore database for this project
                try {
                    firebaseDb = initializeFirestore(firebaseApp, {}, 'i3-testnet');
                } catch (e) {
                    console.warn('initializeFirestore failed, falling back to default database:', e);
                    firebaseDb = getFirestore(firebaseApp);
                }
                // 暴露到全局以便其他脚本访问
                window.firebaseApp = firebaseApp;
                window.firebaseAuth = firebaseAuth;
                window.firebaseDb = firebaseDb;
                // 记录已连接的 Firestore 数据库名称
                try {
                    const proj = (firebaseDb && firebaseDb._databaseId && firebaseDb._databaseId.projectId) || firebaseConfig.projectId;
                    const dbId = (firebaseDb && firebaseDb._databaseId && firebaseDb._databaseId.database) || '(default)';
                    console.log('✅ Firestore ready:', { projectId: proj, databaseId: dbId });
                } catch (_) {}
                
                // 🔑 关键修复：暴露到 window,方便其他脚本 & Console 调试
                Object.assign(window, { firebaseApp, firebaseAuth, firebaseDb });
                
                // Notify listeners that Firebase is ready
                try { window.dispatchEvent(new Event('firebaseReady')); } catch (_) {}
                
                console.log('✅ Firebase 初始化成功');
                
                // 设置认证状态监听器
                onAuthStateChanged(firebaseAuth, async (user) => {
                    if (user) {
                        console.log('用户已登录:', user.email);
                        currentUser = user;
                        // 🔑 让其他逻辑识别已登录
                        window.currentUser = user;
                        // 记录登录时间与次数
                        try {
                            await upsertUserLogin(user);
                            console.log('🕒 Google login at (client):', new Date().toISOString());
                        } catch (e) { console.warn('记录登录时间失败(可忽略):', e); }
                        // 若钱包已连接，自动将钱包保存到 users/<uid>
                        try {
                            if (window.walletManager && window.walletManager.isConnected && window.walletManager.walletAddress) {
                                const address = window.walletManager.walletAddress;
                                if (window.ethereum && typeof window.ethereum.request === 'function') {
                                    window.ethereum.request({ method: 'eth_chainId' }).then((cid) => {
                                        if (typeof window.onWalletConnected === 'function') window.onWalletConnected(address, cid);
                                    }).catch(() => {
                                        if (typeof window.onWalletConnected === 'function') window.onWalletConnected(address);
                                    });
                                } else if (typeof window.onWalletConnected === 'function') {
                                    window.onWalletConnected(address);
                                }
                            }
                        } catch (linkErr) {
                            console.warn('自动链接钱包到用户失败（可忽略）:', linkErr);
                        }
                        updateUIForSignedInUser(user);
                        loadUserData(user.uid);
                    } else {
                        console.log('用户已退出');
                        currentUser = null;
                        window.currentUser = null; // 可选
                        updateUIForSignedOutUser();
                    }
                });
                
                // 更新状态显示（元素可能不存在，做防御性判断）
                (function(){
                    const el = document.getElementById('googleSignInStatus');
                })();
                
                // 🔑 关键修复：Firebase 初始化成功后，重新绑定登录按钮事件并启用按钮
                bindGoogleSignInEvent();
                
                // 启用登录按钮（元素可能不存在）
                (function(){
                    const googleSignInBtn = document.getElementById('googleSignInBtn');
                    if (googleSignInBtn) {
                        googleSignInBtn.disabled = false;
                        googleSignInBtn.style.opacity = '1';
                        googleSignInBtn.style.cursor = 'pointer';
                        console.log('✅ Google 登录按钮已启用');
                    }
                })();
                
            } catch (error) {
                console.error('❌ Firebase 初始化失败:', error);
                const el = document.getElementById('googleSignInStatus');
                if (el) el.textContent = 'Firebase 加载失败，请刷新页面重试';
            }
        }

        // Google 登录处理函数 - 安全版本
        async function handleGoogleSignIn(mode) {
            try {
                // 双重检查：确保 Firebase 已初始化
                if (!firebaseAuth || !firebaseApp) {
                    console.error('❌ Firebase 未初始化');
                    alert('Firebase 还未加载完成，请稍后再试');
                    return;
                }
                
                (function(){
                    const el = document.getElementById('googleSignInStatus');
                    if (el) el.textContent = 'Logging in...';
                })();
                
                const { GoogleAuthProvider, signInWithPopup, signInWithRedirect } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
                const provider = new GoogleAuthProvider();
                // 强制每次登录时都要求用户重新选择账户或输入密码
                provider.setCustomParameters({
                    prompt: 'login'
                });
                
                // 当由钱包连接自动触发时，优先尝试弹窗，若被拦截则回退到重定向
                if (mode === 'auto') {
                    try {
                        const result = await signInWithPopup(firebaseAuth, provider);
                        console.log('✅ 登录成功:', result.user.email);
                        (function(){
                            const el = document.getElementById('googleSignInStatus');
                            if (el) el.textContent = 'Log in successful！';
                        })();
                    } catch (popupErr) {
                        const code = popupErr && popupErr.code;
                        if (code === 'auth/popup-blocked' || code === 'auth/cancelled-popup-request') {
                            console.warn('Popup blocked or cancelled; falling back to redirect login');
                            await signInWithRedirect(firebaseAuth, provider);
                            // 页面将跳转进行登录
                            return;
                        }
                        throw popupErr;
                    }
                } else {
                    const result = await signInWithPopup(firebaseAuth, provider);
                    console.log('✅ 登录成功:', result.user.email);
                    (function(){
                        const el = document.getElementById('googleSignInStatus');
                        if (el) el.textContent = 'Log in successful！';
                    })();
                }
                
            } catch (error) {
                console.error('❌ Log in failed:', error);
                if (error.code === 'auth/unauthorized-domain') {
                    const el = document.getElementById('googleSignInStatus');
                    if (el) el.textContent = '域名未授权，请在 Firebase 控制台添加当前域名';
                } else {
                    const el = document.getElementById('googleSignInStatus');
                    if (el) el.textContent = 'Log in failed: ' + error.message;
                }
            }
        }

        // Expose sign-in function globally so other scripts can invoke it
        window.handleGoogleSignIn = handleGoogleSignIn;

        // 🔑 关键修复：安全的按钮事件绑定函数
        function bindGoogleSignInEvent() {
            const googleSignInBtn = document.getElementById('googleSignInBtn');
            if (googleSignInBtn) {
                // 移除旧的事件监听器（如果有的话）
                googleSignInBtn.replaceWith(googleSignInBtn.cloneNode(true));
                
                // 获取新的按钮引用
                const newBtn = document.getElementById('googleSignInBtn');
                
                // 绑定新的事件监听器
                newBtn.addEventListener('click', handleGoogleSignIn);
                
                console.log('✅ Google 登录按钮事件绑定成功');
            }
        }

        // 更新已登录用户的 UI
        function updateUIForSignedInUser(user) {
            // 隐藏 Google 登录按钮（元素可能不存在）
            (function(){
                const btn = document.getElementById('googleSignInBtn');
                if (btn) btn.style.display = 'none';
                const status = document.getElementById('googleSignInStatus');
                if (status) status.textContent = `Already Logged in: ${user.email}`;
            })();
            
            // 保持钱包连接部分可见（元素可能不存在）
            (function(){
                const ws = document.getElementById('walletSection');
                if (ws) ws.style.display = 'block';
            })();
            
            // 更新账户按钮文本
            const accountBtnText = document.getElementById('accountBtnText');
            if (accountBtnText) {
                accountBtnText.textContent = user.displayName || user.email;
            }
            
            // 显示 logout 按钮
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.style.display = 'block';
            }
            
            console.log('✅ 用户已登录，钱包功能保持可见，logout 按钮已激活');
        }

        // 更新未登录用户的 UI
        function updateUIForSignedOutUser() {
            // 显示 Google 登录按钮（元素可能不存在）
            (function(){
                const btn = document.getElementById('googleSignInBtn');
                if (btn) btn.style.display = 'flex';
                const status = document.getElementById('googleSignInStatus');
            })();
            
            // 保持钱包连接部分可见（元素可能不存在）
            (function(){
                const ws = document.getElementById('walletSection');
                if (ws) ws.style.display = 'block';
            })();
            
            // 恢复账户按钮文本
            const accountBtnText = document.getElementById('accountBtnText');
            if (accountBtnText) {
                accountBtnText.textContent = 'Login';
            }
            
            // 隐藏 logout 按钮
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.style.display = 'none';
            }
            
            console.log('❌ 用户已退出，钱包功能保持可见，logout 按钮已隐藏');
        }

        // 加载用户数据
        async function loadUserData(uid) {
            try {
                if (!firebaseDb) return;
                
                const { doc, getDoc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                const userRef = doc(firebaseDb, 'users', uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    console.log('用户数据已存在');
                } else {
                    // 创建新用户文档
                    const userData = {
                        uid: uid,
                        email: currentUser.email,
                        displayName: currentUser.displayName,
                        photoURL: currentUser.photoURL,
                        lastLogin: new Date(),
                        createdAt: new Date(),
                        isActive: true
                    };
                    
                    await setDoc(userRef, userData);
                    console.log('✅ 新用户文档已创建');
                }
            } catch (error) {
                console.error('❌ 加载用户数据失败:', error);
            }
        }

        // 确保用户文档存在并记录本次登录时间
        async function upsertUserLogin(user) {
            try {
                if (!firebaseDb || !user || !user.uid) return;
                const { doc, getDoc, setDoc, updateDoc, serverTimestamp, increment } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
                const userRef = doc(firebaseDb, 'users', user.uid);
                const snap = await getDoc(userRef);
                if (!snap.exists()) {
                    await setDoc(userRef, {
                        uid: user.uid,
                        email: user.email || null,
                        displayName: user.displayName || null,
                        photoURL: user.photoURL || null,
                        createdAt: serverTimestamp(),
                        isActive: true
                    }, { merge: true });
                }
                await updateDoc(userRef, {
                    lastLoginAt: serverTimestamp(),
                    lastLoginClientAt: new Date().toISOString(),
                    lastLoginProvider: 'google',
                    lastLoginEmail: user.email || null,
                    loginCount: increment(1)
                });
            } catch (e) {
                console.warn('upsertUserLogin error:', e);
            }
        }

        // 每日签到处理函数 - 支持 Admin 本地签到 + 普通用户链上签到
        window.handleDailyCheckin = async function() {
            try {
                // 1. 检查钱包连接
                if (!window.walletManager || !window.walletManager.isConnected) {
                    alert('Please connect your MetaMask wallet to claim the daily check-in bonus.');
                    return;
                }

                // 2. 判断是否为 Admin
                const isAdminUser = window.isAdmin && window.isAdmin();
                
                if (isAdminUser) {
                    // ===== Admin 用户 → 执行完整的本地签到 + Firebase 同步 =====
                    console.log('🔑 Admin user detected, executing local check-in');
                    
                    const address = (window.walletManager.walletAddress || '').toLowerCase();
                    
                    if (window.firebaseDb && address) {
                        const { doc, getDoc, setDoc, updateDoc, serverTimestamp } = 
                            await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');

                        const walletRef = doc(window.firebaseDb, 'wallets', address);
                        const snap = await getDoc(walletRef);

                        let lastCheckinAt = null;
                        let remoteTotalCheckins = 0;
                        
                        if (snap.exists()) {
                            const data = snap.data() || {};
                            lastCheckinAt = data.lastCheckinAt || null;
                            remoteTotalCheckins = Number(data.totalCheckins || 0);
                        } else {
                            await setDoc(walletRef, {
                                address: address,
                                createdAt: serverTimestamp(),
                                totalCheckins: 0
                            }, { merge: true });
                        }

                        // 同步远端时间戳到本地
                        if (lastCheckinAt && typeof lastCheckinAt.toMillis === 'function') {
                            try { 
                                localStorage.setItem('last_checkin_at', String(lastCheckinAt.toMillis())); 
                            } catch (_) {}
                        }

                        // 执行本地签到
                        const result = window.walletManager.dailyCheckin();
                        if (!result || !result.success) {
                            alert(result?.error || '签到失败，请稍后重试');
                            return;
                        }

                        // 同步到 Firestore
                        try {
                            await updateDoc(walletRef, {
                                lastCheckinAt: serverTimestamp(),
                                totalCheckins: remoteTotalCheckins + 1,
                                credits: window.walletManager.credits,
                                lastUpdated: serverTimestamp(),
                                lastCheckinType: 'local-admin'
                            });
                        } catch (e) {
                            console.warn('⚠️ 更新 Firestore 失败（可忽略）：', e);
                        }

                        // 同步到 users_by_wallet
                        try {
                            const walletUserRef = doc(window.firebaseDb, 'users_by_wallet', address);
                            await setDoc(walletUserRef, {
                                lastCheckinAt: serverTimestamp(),
                                totalCheckins: remoteTotalCheckins + 1,
                                lastUpdated: serverTimestamp()
                            }, { merge: true });
                        } catch (e) {
                            console.warn('⚠️ 同步失败（可忽略）：', e);
                        }

                        // 如果有 Google 账户，同步到 users/<uid>
                        if (window.currentUser && window.currentUser.uid) {
                            try {
                                const userRef = doc(window.firebaseDb, 'users', window.currentUser.uid);
                                await updateDoc(userRef, { lastUpdated: serverTimestamp() });
                            } catch (e) {
                                console.warn('⚠️ 同步到 users 失败（可忽略）：', e);
                            }
                        }

                        return;
                    }

                    // Firebase 不可用时的降级处理
                    const result = window.walletManager.dailyCheckin();
                    if (!result || !result.success) {
                        alert(result?.error || '签到失败，请稍后重试');
                    }
                    
                } else {
                    // ===== 普通用户 → 打开链上签到 Modal =====
                    console.log('👤 Regular user detected, opening on-chain check-in modal');
                    
                    if (typeof window.openOnChainCheckInModal === 'function') {
                        // 先加载用户状态
                        if (typeof window.loadUserCheckInStatus === 'function') {
                            await window.loadUserCheckInStatus();
                        }
                        window.openOnChainCheckInModal();
                    } else {
                        console.error('On-chain check-in modal function not found');
                        alert('Check-in feature not available');
                    }
                }
                
            } catch (error) {
                console.error('签到失败:', error);
                alert('签到失败: ' + error.message);
            }
        };


        // Global helper: clear ALL local data (localStorage and sessionStorage) ONLY.
        // Does not sign out or disconnect wallet. Backward compatible signature.
        // Usage:
        //   window.clearAllLocalData();            // clear only
        //   window.clearAllLocalData(true);        // confirm, then clear
        //   window.clearAllLocalData({ reload: true, confirmFirst: true });
        window.clearAllLocalData = async function(optionsOrConfirm) {
            const opts = (typeof optionsOrConfirm === 'object') ? optionsOrConfirm : { confirmFirst: !!optionsOrConfirm };
            const confirmFirst = !!opts.confirmFirst;
            const reload = !!opts.reload;

            try {
                if (confirmFirst) {
                    const ok = window.confirm('This will remove ALL local data for this site (including chat, workflows, wallet archives). Continue?');
                    if (!ok) return;
                }

                // Clear storages only (no server-side changes)
                try { localStorage.clear(); } catch (_) {}
                try { if (window.sessionStorage) sessionStorage.clear(); } catch (_) {}
                console.log('🧹 All local data cleared');

                if (reload) {
                    try { window.location.reload(); } catch (_) {}
                }
            } catch (err) {
                console.error('Error clearing local data:', err);
            }
        };

        // Google 登出处理函数
        window.handleGoogleLogout = async function() {
            try {
                if (!firebaseAuth) {
                    alert('Firebase 未初始化');
                    return;
                }
                
                // 从 firebase-auth 导入 signOut，而不是 firestore
                const { signOut } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
                await signOut(firebaseAuth);
                
                console.log('✅ Google 登出成功');
                
                // 更新 UI 状态
                updateUIForSignedOutUser();
                
                // 关闭下拉菜单
                const dropdown = document.getElementById('accountDropdown');
                if (dropdown) {
                    dropdown.classList.remove('show');
                }
                
            } catch (error) {
                console.error('❌ 登出失败:', error);
                alert('登出失败: ' + error.message);
            }
        };

        // 显示钱包选择模态框 - 修复事件冒泡问题 + 延迟机制
        window.showWalletSelectionModal = function(event) {
            // 阻止事件冒泡，防止触发外部点击关闭
            if (event) {
                event.stopPropagation();
            }
            
            // 关闭下拉菜单
            const dropdown = document.getElementById('accountDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        
            // 显示模态框
            const modal = document.getElementById('walletModal');
            modal.style.display = 'flex';
            modal.classList.add('show');
            
            // 延迟启用外部点击关闭，避免竞态条件
            setTimeout(() => {
                modal.dataset.readyToClose = 'true';
            }, 100);
        };

        // 关闭钱包模态框 - 完全复制自benchmark.html的工作版本
        window.closeWalletModal = function() {
            const modal = document.getElementById('walletModal');
            if (modal) {
                modal.classList.remove('show');
                modal.dataset.readyToClose = 'false'; // 重置延迟标志
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        };

        // 检查 Firebase 状态并显示钱包模态框
        window.checkFirebaseAndShowWalletModal = function(event) {
            if (!window.firebaseDb) {
                alert('Firebase 加载中，请稍后再试...');
                return;
            }
            showWalletSelectionModal(event);
        };

        // 测试函数 - 手动切换显示状态
        window.testUI = function() {
            const googleSignInBtn = document.getElementById('googleSignInBtn');
            const walletSection = document.getElementById('walletSection');
            
            if (googleSignInBtn && walletSection) {
                if (googleSignInBtn.style.display === 'none') {
                    // 显示 Google 登录，隐藏钱包
                    googleSignInBtn.style.display = 'flex';
                    walletSection.style.display = 'none';
                    console.log('✅ 显示 Google 登录，隐藏钱包功能');
                } else {
                    // 隐藏 Google 登录，显示钱包
                    googleSignInBtn.style.display = 'none';
                    walletSection.style.display = 'block';
                    console.log('✅ 隐藏 Google 登录，显示钱包功能');
                }
            }
        };

        // 显示登录提示弹窗
        function showLoginPromptModal() {
            const modal = document.getElementById('loginPromptModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('show');
                setTimeout(() => {
                    modal.dataset.readyToClose = 'true';
                }, 100);
            }
        }

        // 关闭登录提示弹窗
        function closeLoginPromptModal() {
            const modal = document.getElementById('loginPromptModal');
            if (modal) {
                modal.classList.remove('show');
                modal.dataset.readyToClose = 'false';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        // 从提示弹窗触发 Google 登录
        function handleGoogleSignInFromPrompt() {
            closeLoginPromptModal();
            handleGoogleSignIn();
        }

        // 从提示弹窗触发钱包连接
        function connectWalletFromPrompt() {
            closeLoginPromptModal();
            showWalletSelectionModal();
        }

        // 初始化 Firebase 和 UI - 修复版本
        function initializeFirebaseAndUI() {
            // Guard to avoid double init
            try { window._firebaseInitStarted = true; } catch (_) {}
            console.log('🚀 开始初始化 Firebase 和 UI...');
            
            // 确保所有元素都存在
            const googleSignInBtn = document.getElementById('googleSignInBtn');
            const walletSection = document.getElementById('walletSection');
            const googleSignInStatus = document.getElementById('googleSignInStatus');
            
            if (googleSignInBtn && walletSection && googleSignInStatus) {
                console.log('✅ 所有 UI 元素已找到');
                
                // 初始化时显示 Google 登录和钱包功能
                googleSignInBtn.style.display = 'flex';
                walletSection.style.display = 'block';
                
                // 🔑 关键修复：初始时禁用按钮，等 Firebase 加载完成后再启用
                googleSignInBtn.disabled = true;
                googleSignInBtn.style.opacity = '0.6';
                googleSignInBtn.style.cursor = 'not-allowed';
                
                // 初始时隐藏 logout 按钮
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.style.display = 'none';
                }
                
                console.log('✅ UI 初始化完成，等待 Firebase 加载...');
            } else {
                console.error('❌ 某些 UI 元素未找到');
            }
            
            // 初始化 Firebase
            initializeFirebase();

            // Optional auto Google login only if user explicitly enabled the setting
            try {
                const autoGoogle = (localStorage.getItem('autoGoogleOnWalletConnect') || 'off') === 'on';
                if (autoGoogle && window.walletManager && window.walletManager.isConnected) {
                    const attemptAutoLogin = () => {
                        if (window.firebaseAuth && !window.firebaseAuth.currentUser && typeof window.handleGoogleSignIn === 'function') {
                            window.handleGoogleSignIn('auto');
                        }
                    };
                    attemptAutoLogin();
                    setTimeout(attemptAutoLogin, 800);
                }
            } catch (_) {}
        }

        // Expose initialization functions globally for console/manual triggers
        window.initializeFirebase = initializeFirebase;
        window.initializeFirebaseAndUI = initializeFirebaseAndUI;

        // 将钱包连接信息写入 Firestore（无需强制 Google 登录）
        // 说明：
        // - 若 currentUser 存在，则写入 users/<uid> 与其子集合 wallets/<address>
        // - 无论是否登录，都会写入顶层 wallets/<address> 文档，便于独立管理钱包
        window.onWalletConnected = async function(address, chainId, networkName) {
            try {
                if (!firebaseDb) throw new Error('Firebase 未初始化');
                if (!address) throw new Error('address 不能为空');

                const { doc, setDoc, getDoc, updateDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');

                // 1) 顶层集合：wallets/<address>
                const walletRef = doc(firebaseDb, 'wallets', address);
                await setDoc(walletRef, {
                    address: address,
                    chainId: chainId || null,
                    networkName: networkName || null,
                    lastConnectedAt: serverTimestamp(),
                    credits: (window.walletManager && typeof window.walletManager.credits === 'number') ? window.walletManager.credits : 0
                }, { merge: true });

                // 1.5) 新增：wallet-only 用户档案 users_by_wallet/<address>（仅未登录时）
                if (!window.currentUser || !window.currentUser.uid) {
                    try {
                        const walletUserRef = doc(firebaseDb, 'users_by_wallet', address.toLowerCase());
                        const stageSnap = await getDoc(walletUserRef);
                        if (stageSnap.exists()) {
                            // 仅更新连接信息，保留首次 createdAt
                            await updateDoc(walletUserRef, {
                                lastConnectedAt: serverTimestamp(),
                                chainId: chainId || null,
                                networkName: networkName || null,
                                userType: 'wallet-only'
                            });
                        } else {
                            // 首次创建，写入 createdAt
                            await setDoc(walletUserRef, {
                                address: address,
                                createdAt: serverTimestamp(),
                                lastConnectedAt: serverTimestamp(),
                                chainId: chainId || null,
                                networkName: networkName || null,
                                userType: 'wallet-only'
                            }, { merge: true });
                        }
                    } catch (e) {
                        console.warn('写入 users_by_wallet 失败（开发环境可忽略）:', e);
                    }
                }

                // 2) 如已登录 Google，则同步到用户空间
                if (window.currentUser && window.currentUser.uid) {
                    const userRef = doc(firebaseDb, 'users', window.currentUser.uid);
                    const userDocSnap = await getDoc(userRef);
                    if (!userDocSnap.exists()) {
                        await setDoc(userRef, {
                            uid: window.currentUser.uid,
                            email: window.currentUser.email || null,
                            displayName: window.currentUser.displayName || null,
                            createdAt: serverTimestamp(),
                            isActive: true
                        }, { merge: true });
                    }

                    // 尝试从 staging 文档(users_by_wallet)合并数据（不再合并 credits）
                    let stagedTotalCheckins = 0;
                    try {
                        const walletUserRef = doc(firebaseDb, 'users_by_wallet', address.toLowerCase());
                        const stageSnap = await getDoc(walletUserRef);
                        if (stageSnap.exists()) {
                            const s = stageSnap.data() || {};
                            stagedTotalCheckins = Number(s.totalCheckins || 0);
                        }
                    } catch (e) {
                        console.warn('读取 users_by_wallet staging 失败（可忽略）:', e);
                    }

                    await updateDoc(userRef, {
                        primaryWallet: address,
                        primaryChainId: chainId || null,
                        primaryNetwork: networkName || null,
                        walletLinkedAt: serverTimestamp(),
                        walletOnlyProfile: address.toLowerCase()
                    });

                    const userWalletRef = doc(firebaseDb, 'users', window.currentUser.uid, 'wallets', address);
                    await setDoc(userWalletRef, {
                        address: address,
                        chainId: chainId || null,
                        networkName: networkName || null,
                        lastConnectedAt: serverTimestamp(),
                        totalCheckins: stagedTotalCheckins
                    }, { merge: true });

                    // 标记钱包与用户已链接
                    try {
                        await updateDoc(walletRef, {
                            linkedUid: window.currentUser.uid,
                            linkedAt: serverTimestamp()
                        });
                    } catch (e) {
                        console.warn('标记钱包链接失败（可忽略）:', e);
                    }

                    // 标记 staging 文档为已链接（保留以兼容历史逻辑）
                    try {
                        const walletUserRef = doc(firebaseDb, 'users_by_wallet', address.toLowerCase());
                        await setDoc(walletUserRef, {
                            linked: true,
                            linkedUid: window.currentUser.uid,
                            linkedAt: serverTimestamp()
                        }, { merge: true });
                    } catch (e) {
                        console.warn('标记 users_by_wallet 已链接失败（可忽略）:', e);
                    }
                }

                // 3) UI 提示
                const info = document.getElementById('walletInfo');
                if (info) {
                    info.style.display = 'block';
                    info.textContent = `Connected Wallet: ${address}`;
                }

                // Log client-side connection time
                console.log('🕒 Wallet connected at (client):', new Date().toISOString());

                console.log('✅ 钱包信息已写入 Firestore', { address, chainId, networkName });
                // 标记钱包已连接
                localStorage.setItem('walletConnected', 'true');
            } catch (err) {
                console.error('❌ 写入钱包信息到 Firestore 失败:', err);
                alert('保存钱包信息失败：' + err.message);
            }
        };

        // —— 全局错误监听，便于排查初始化被阻断的问题 ——
        window.addEventListener('error', function(e) {
            try {
                console.error('🌋 Global error caught:', e.error || e.message, e.filename, e.lineno, e.colno);
            } catch (_) {}
        });
        window.addEventListener('unhandledrejection', function(e) {
            try {
                console.error('🌋 Unhandled promise rejection:', e.reason);
            } catch (_) {}
        });

        // —— 兜底：如果此时DOM已准备好（极端时序或缓存导致监听丢失），立即初始化 ——
        (function ensureInit() {
            console.log('🔎 Inline Firebase script loaded, readyState:', document.readyState);
            if (document.readyState === 'interactive' || document.readyState === 'complete') {
                try {
                    console.log('⏩ DOM 已就绪，立即调用 initializeFirebaseAndUI()');
                    if (!window._firebaseInitStarted) initializeFirebaseAndUI();
                } catch (err) {
                    console.error('❌ 兜底初始化失败:', err);
                }
            } else {
                console.log('⌛ 等待 DOMContentLoaded');
            }
        })();

        // Ensure initialization once DOM is ready (in case script ran during 'loading')
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (!window._firebaseInitStarted) {
                    console.log('⏩ DOMContentLoaded -> initializeFirebaseAndUI()');
                    initializeFirebaseAndUI();
                }
            } catch (err) {
                console.error('❌ DOMContentLoaded init failed:', err);
            }
        });
        // Extra safety: also try on full window load
        window.addEventListener('load', function() {
            try {
                if (!window._firebaseInitStarted) {
                    console.log('⏩ window.load -> initializeFirebaseAndUI()');
                    initializeFirebaseAndUI();
                }
            } catch (err) {
                console.error('❌ window.load init failed:', err);
            }
        });
    </script>

    <!-- 钱包选择模态框 -->
    <div id="walletModal" class="wallet-modal">
        <div class="wallet-modal-content">
            <button class="wallet-close-btn" onclick="closeWalletModal()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <div class="wallet-modal-header">
                <h2 class="wallet-modal-title">Log in or sign up</h2>
                <p class="wallet-modal-subtitle">Log in and connect wallet to earn I3 tokens</p>
            </div>

            <div class="wallet-options">
                <!-- MetaMask 选项 -->
                <div class="wallet-option available" onclick="connectMetaMaskWallet()">
                    <span class="wallet-icon-wrap">
                    <!-- 你自己的官方 SVG/PNG -->
                        <img src="/assets/metamask-Bi8-dQLc.svg" alt="MetaMask">
                    </span>
                    <div class="wallet-info">
                        <div class="wallet-name">MetaMask</div>
                    </div>
                </div>

                <!-- Update the WalletConnect option in your wallet modal -->
                <div class="wallet-option available" onclick="connectWalletConnect()">
                    <span class="wallet-icon-wrap">
                    <!-- 你自己的官方 SVG/PNG -->
                        <img src="data:image/svg+xml,%3csvg%20role='img'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%20id='Walletconnect--Streamline-Simple-Icons'%20height='24'%20width='24'%3e%3cdesc%3e%20Walletconnect%20Streamline%20Icon:%20https://streamlinehq.com%20%3c/desc%3e%3ctitle%3eWalletConnect%3c/title%3e%3cpath%20d='M4.913%207.519c3.915%20-3.831%2010.26%20-3.831%2014.174%200l0.471%200.461a0.483%200.483%200%200%201%200%200.694l-1.611%201.577a0.252%200.252%200%200%201%20-0.354%200l-0.649%20-0.634c-2.73%20-2.673%20-7.157%20-2.673%20-9.887%200l-0.694%200.68a0.255%200.255%200%200%201%20-0.355%200L4.397%208.719a0.482%200.482%200%200%201%200%20-0.693l0.516%20-0.507Zm17.506%203.263%201.434%201.404a0.483%200.483%200%200%201%200%200.694l-6.466%206.331a0.508%200.508%200%200%201%20-0.709%200l-4.588%20-4.493a0.126%200.126%200%200%200%20-0.178%200l-4.589%204.493a0.508%200.508%200%200%201%20-0.709%200L0.147%2012.88a0.483%200.483%200%200%201%200%20-0.694l1.434%20-1.404a0.508%200.508%200%200%201%200.709%200l4.589%204.493c0.05%200.048%200.129%200.048%200.178%200l4.589%20-4.493a0.508%200.508%200%200%201%200.709%200l4.589%204.493c0.05%200.048%200.128%200.048%200.178%200l4.589%20-4.493a0.507%200.507%200%200%201%200.708%200Z'%20fill='%23000000'%20stroke-width='1'%3e%3c/path%3e%3c/svg%3e" alt="WalletConnect">
                    </span>
                    <div class="wallet-info">
                        <div class="wallet-name">WalletConnect</div>
                    </div>
                </div>


                <!-- Coinbase Wallet 选项  -->
                <div class="wallet-option available" onclick="connectCoinbaseWallet()">
                    <span class="wallet-icon-wrap">
                    <!-- 你自己的官方 SVG/PNG -->
                        <img src="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='512'%20height='512'%20fill='none'%20viewBox='0%200%20512%20512'%20id='coinbase'%3e%3cg%20clip-path='url(%23clip0_84_15704)'%3e%3crect%20width='512'%20height='512'%20fill='%230052FF'%20rx='60'%3e%3c/rect%3e%3cpath%20fill='%230052FF'%20d='M255.5%2040C375.068%2040%20472%20136.932%20472%20256.5C472%20376.068%20375.068%20473%20255.5%20473C135.932%20473%2039%20376.068%2039%20256.5C39%20136.932%20135.932%2040%20255.5%2040Z'%3e%3c/path%3e%3cpath%20fill='%23fff'%20d='M255.593%20331.733C213.515%20331.733%20179.513%20297.638%20179.513%20255.653C179.513%20213.668%20213.608%20179.573%20255.593%20179.573C293.258%20179.573%20324.535%20206.999%20330.547%20242.973H407.19C400.71%20164.826%20335.337%20103.398%20255.5%20103.398C171.436%20103.398%20103.245%20171.589%20103.245%20255.653C103.245%20339.717%20171.436%20407.907%20255.5%20407.907C335.337%20407.907%20400.71%20346.48%20407.19%20268.333H330.453C324.441%20304.307%20293.258%20331.733%20255.593%20331.733Z'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_84_15704'%3e%3crect%20width='512'%20height='512'%20fill='%23fff'%3e%3c/rect%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e" alt="Coinbase">
                    </span>
                    <div class="wallet-info">
                        <div class="wallet-name">Coinbase Wallet</div>
                    </div>
                </div>

                <!-- Binance Wallet 选项 -->
                <div class="wallet-option available" onclick="connectBinanceWallet()">
                    <span class="wallet-icon-wrap">
                        <!-- 使用 binance_wallet.jpeg 作为图标 -->
                        <img src="/assets/binance_wallet-CeAudAwg.jpeg" alt="Binance Wallet">
                    </span>
                    <div class="wallet-info">
                        <div class="wallet-name">Binance Wallet</div>
                    </div>
                </div>

                <!-- Phantom (Solana) -->
				<div class="wallet-option available" onclick="connectSolanaPhantom()">
				    <span class="wallet-icon-wrap">
                    <!-- 你自己的官方 SVG/PNG -->
                        <img src="data:image/svg+xml,%3csvg%20width='128'%20height='128'%20viewBox='0%200%20128%20128'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='128'%20height='128'%20fill='%23AB9FF2'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M55.6416%2082.1477C50.8744%2089.4525%2042.8862%2098.6966%2032.2568%2098.6966C27.232%2098.6966%2022.4004%2096.628%2022.4004%2087.6424C22.4004%2064.7584%2053.6445%2029.3335%2082.6339%2029.3335C99.1257%2029.3335%20105.697%2040.7755%20105.697%2053.7689C105.697%2070.4471%2094.8739%2089.5171%2084.1156%2089.5171C80.7013%2089.5171%2079.0264%2087.6424%2079.0264%2084.6688C79.0264%2083.8931%2079.1552%2083.0527%2079.4129%2082.1477C75.7409%2088.4182%2068.6546%2094.2361%2062.0192%2094.2361C57.1877%2094.2361%2054.7397%2091.1979%2054.7397%2086.9314C54.7397%2085.3799%2055.0618%2083.7638%2055.6416%2082.1477ZM80.6133%2053.3182C80.6133%2057.1044%2078.3795%2058.9975%2075.8806%2058.9975C73.3438%2058.9975%2071.1479%2057.1044%2071.1479%2053.3182C71.1479%2049.532%2073.3438%2047.6389%2075.8806%2047.6389C78.3795%2047.6389%2080.6133%2049.532%2080.6133%2053.3182ZM94.8102%2053.3184C94.8102%2057.1046%2092.5763%2058.9977%2090.0775%2058.9977C87.5407%2058.9977%2085.3447%2057.1046%2085.3447%2053.3184C85.3447%2049.5323%2087.5407%2047.6392%2090.0775%2047.6392C92.5763%2047.6392%2094.8102%2049.5323%2094.8102%2053.3184Z'%20fill='%23FFFDF8'/%3e%3c/svg%3e" alt="Phantom">
                    </span>
				    <div class="wallet-info">
				        <div class="wallet-name">Phantom (Solana)</div>
				    </div>
				</div>

                <div class="wallet-footer">
                    By Intelligence Cubed
                </div>

            </div>
        </div>
    </div>

    <!-- 链上签到 Modal -->
    <div id="onChainCheckInModal" class="wallet-modal" style="display: none;">
        <div class="wallet-modal-content" style="max-width: 520px;">
            <button class="wallet-close-btn" onclick="closeOnChainCheckInModal()">✕</button>
            
            <div class="wallet-modal-header">
                <h2 class="wallet-modal-title">✅ Check-In on Chain</h2>
                <p class="wallet-modal-subtitle">Complete your daily on-chain check-in to earn I3 credits</p>
            </div>

            <div id="userStatusSection" style="margin: 20px 0; padding: 16px; background: #f0fdf4; border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <div>
                        <p style="font-size: 12px; color: #059669; margin-bottom: 4px;">Current Streak</p>
                        <p id="currentStreak" style="font-size: 24px; font-weight: 700; color: #10b981; margin: 0;">0 days</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 12px; color: #059669; margin-bottom: 4px;">Total Check-ins</p>
                        <p id="totalCheckIns" style="font-size: 24px; font-weight: 700; color: #10b981; margin: 0;">0</p>
                    </div>
                </div>
                <div style="padding-top: 12px; border-top: 1px solid #d1fae5;">
                    <p style="font-size: 12px; color: #059669; margin-bottom: 4px;">Estimated Reward</p>
                    <p id="nextReward" style="font-size: 20px; font-weight: 700; color: #10b981; margin: 0;">30 credits</p>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <label style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">Select Network</label>
                <select id="chainSelector" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                    <option value="BSC">BNB Smart Chain (BSC)</option>
                    <option value="OPBNB">opBNB Mainnet</option>
                    <option value="ETH">Ethereum Mainnet</option>
                    <option value="BASE">Base Mainnet</option>
                    <option value="SOLANA_DEVNET">Solana Devnet</option>
                    <option value="SOLANA_MAINNET">Solana Mainnet</option>
                </select>
            </div>

            <div style="margin: 20px 0; padding: 12px; background: #fef3c7; border-radius: 8px; border: 1px solid #fcd34d;">
                <p style="font-size: 13px; color: #92400e; margin: 0;">⛽ Gas fee: ~$0.03</p>
            </div>

            <button id="executeCheckInBtn" onclick="executeOnChainCheckIn()" 
                    style="width: 100%; padding: 16px; background: linear-gradient(135deg, #10b981, #059669); 
                           color: white; border: none; border-radius: 12px; 
                           font-size: 16px; font-weight: 600; cursor: pointer; margin-bottom: 12px;">
                Check In Now
            </button>

            <div id="checkInLoading" style="display: none; text-align: center; padding: 20px;">
                <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #e5e7eb; 
                            border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p id="loadingText" style="margin-top: 12px; color: #6b7280; font-size: 14px;">Processing...</p>
            </div>

            <p style="text-align: center; font-size: 12px; color: #6b7280; margin: 0;">
                Recorded on blockchain for transparency.
            </p>
        </div>
    </div>

    <style>
    @keyframes spin { to { transform: rotate(360deg); } }
    #executeCheckInBtn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
    #executeCheckInBtn:disabled { background: #d1d5db; cursor: not-allowed; }
    </style>